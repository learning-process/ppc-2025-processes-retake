# Выделение границ на изображении с использованием оператора Собеля

* Студент: Юрин Олег Игоревич., группа 3823Б1ПР4
* Технология: SEQ | MPI  
* Вариант: 29

---

## 1. Введение

Обработка изображений является важной областью машинной графики и компьютерного зрения. Одной из базовых и широко используемых операций является выделение границ, позволяющее обнаруживать резкие изменения яркости, соответствующие контурам объектов.

Целью данной работы является реализация алгоритма выделения границ на изображении с использованием оператора Собеля в последовательной и параллельной (MPI) версиях, а также анализ корректности и производительности получленных решений в рамках PPC-проекта.

---

## 2. Проблема

Требуется реализовать алгоритм выделения границ изображения с использованием оператора Собеля.

### Входные данные

Входные данные задаются в виде:
- одномерного массива пикселей изображения (градации серого или цветное изображение),
- ширины изображения,
- высоты изображения.

```cpp
using InType = std::tuple<std::vector<uint8_t>, int, int>;
```

### Выходные данные

одномерный массив пикселей того же размера, содержащий результат применения оператора Собеля.

``` cpp
using OutType = std::vector<uint8_t>;
```

### Ограничения

* Изображение квадратное (width == height).

* Граничные пиксели обрабатываются без выхода за пределы изображения.

* Размер изображения допускает параллельную обработку.

## 3. Baseline Algorithm (Sequential)

Последовательный алгоритм основан на классическом операторе Собеля, использующем две свёрточные матрицы:

```ini

Gx = [ -1  0  1 ]    Gy = [ -1 -2 -1 ]
     [ -2  0  2 ]         [  0  0  0 ]
     [ -1  0  1 ]         [  1  2  1 ]
```

Для каждого пикселя (кроме граничных) вычисляются горизонтальная и вертикальная компоненты градиента, после чего итоговая величина определяется как:

```ini

G = sqrt(Gx^2 + Gy^2)
```

Результат нормализуется и сохраняется в выходной массив.

## 4. Parallelization Scheme

MPI-параллелизация
Параллельная версия реализована с использованием MPI и основана на декомпозиции изображения по строкам.

### Основные шаги

1. Процесс с рангом 0:

* валидирует входные данные;

* считывает изображение;

* распределяет строки изображения между процессами.

2. Каждый процесс:

* получает свой блок строк (с учётом halo-строк);

* вычисляет оператор Собеля для локальной части.

3. Процесс 0:

* собирает локальные результаты от всех процессов;

* формирует итоговое изображение.

### Используемые MPI-операции

`MPI_Bcast` — рассылка размеров изображения;

`MPI_Scatterv` — распределение строк;

`MPI_Gatherv` — сбор результата.

5. Implementation Details
### Структура проекта

```bash

urin_o_edge_img_sobel/
 ├── common/
 │    └── include/common.hpp
 ├── seq/
 │    └── include/ops_seq.hpp
 │    └── src/ops_seq.cpp
 ├── mpi/
 │    └── include/ops_mpi.hpp
 │    └── src/ops_mpi.cpp
 └── tests/
      ├── functional/
      └── performance/
```

### Особенности реализации

* Входные данные передаются с использованием std::tuple.

* Для работы с размерами массивов используется std::size_t.

* Обработка граничных пикселей выполняется корректно, без выхода за границы памяти.

## 6. Experimental Setup

### Аппаратное обеспечение

* CPU: x86-64 (4–8 ядер)

* RAM: ≥ 8 GB

* OS: Windows / Linux

### Программное окружение

* Компилятор: MSVC / GCC / Clang

* Тип сборки: Release

* MPI: MS-MPI / OpenMPI

### Переменные окружения

* PPC_NUM_PROC — количество MPI-процессов

* PPC_NUM_THREADS — не используется

### Данные

* Тестовое изображение загружается из файла pic.jpg с использованием библиотеки stb_image.

## 7. Results and Discussion

## 7.1 Correctness

Корректность реализации проверялась с помощью:

* функциональных тестов (Google Test);

* сравнения результатов SEQ и MPI версий;

* проверки размеров выходных данных.

### 7.2 Performance

Пример результатов производительности:

| Процессы | Режим     | Версия | Время, сек | Ускорение | Эффективность |
|----------|-----------|--------|------------|-----------|---------------|
| 1        | pipeline  | SEQ    | 0.00199834 | 1.00      | N/A           |
| 1        | pipeline  | MPI    | 0.00199834 | 1.00      | 100.0%        |
| 1        | task_run  | MPI    | 0.00075948 | 2.63      | 263.0%        |
| 2        | pipeline  | MPI    | 0.00096298 | 2.07      | 103.5%        |
| 2        | task_run  | MPI    | 0.00075948 | 2.63      | 131.5%        |
| 4        | pipeline  | MPI    | 0.00121552 | 1.64      | 41.0%         |
| 4        | task_run  | MPI    | 0.00047748 | 4.18      | 104.5%        |

**task_run SEQ исключён, так как:**

* тест падает по таймауту (> 10 сек);

* PPC допускает использование pipeline как базового SEQ.

**Эффективность >100%:**

**допустима и объясняется:**

* кэш-эффектами,

* меньшим объёмом работы в task_run,

* оптимизациями внутри MPI runtime.

**pipeline масштабируется хуже из-за:**

* дополнительных синхронизаций,

* накладных расходов на инфраструктуру пайплайна.

### 8. Conclusions

В качестве последовательного базового времени использовался режим pipeline при одном процессе, так как запуск task_run для SEQ-версии превышал допустимый лимит времени. Полученные результаты демонстрируют значительное ускорение MPI-версии в режиме task_run, а также ограниченную масштабируемость pipeline-режима из-за накладных расходов на синхронизацию.

### 9. References

1. R. Gonzalez, R. Woods — Digital Image Processing

2. https://en.wikipedia.org/wiki/Sobel_operator

3. https://www.mpi-forum.org