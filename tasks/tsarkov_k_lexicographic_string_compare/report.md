# Проверка лексикографической упорядоченности двух строк

- Student: Царьков Клим Александрович, группа 3823Б1ПР4
- Technology: MPI + SEQ
- Variant: 26

## 1. Introduction

Лексикографическое сравнение строк является базовой операцией,
используемой в алгоритмах сортировки, поиска и обработки текста.

Цель работы — реализовать проверку лексикографической упорядоченности двух строк
в последовательной (SEQ) и параллельной (MPI) версиях, а также оценить ускорение
и эффективность параллельной реализации.

## 2. Problem Statement

Даны две строки `s1` и `s2`.

Необходимо определить, выполняется ли условие:

```cpp
s1 <= s2   //(лексикографически)
```

### Входные данные

Пара строк произвольной длины.

### Выходные данные

Целое число:

- `1` — если `s1` лексикографически меньше либо равна `s2`
- `0` — в противном случае

### Ограничения

- Строки могут иметь разную длину.
- Сравнение выполняется посимвольно.
- Если одна строка является префиксом другой, более короткая строка считается меньшей.
- Сравнение выполняется по значениям `unsigned char`.

## 3. Baseline Algorithm (Sequential)

Последовательный алгоритм выполняет посимвольное сравнение строк.

Алгоритм:

1. Вычисляется:

   ```cpp
   min_len = min(|s1|, |s2|)
   ```

2. Для каждого индекса `i` от `0` до `min_len - 1`:
   - если `s1[i] < s2[i]` → результат 1
   - если `s1[i] > s2[i]` → результат 0
3. Если различия не обнаружены:
   - результат определяется по длинам строк.

## 4. Parallelization Scheme

### Распределение данных (MPI)

Процесс с рангом 0:

- получает входные строки,
- передаёт размеры строк через `MPI_Bcast`,
- передаёт содержимое строк всем процессам через `MPI_Bcast`.

Каждый процесс получает полные копии строк.

### Локальная обработка

Каждый процесс ищет первый индекс в своём диапазоне, где символы строк различаются.
Если различий не найдено, используется значение-страж: UINT64_MAX

### Глобальная редукция

Для нахождения глобального первого индекса различия используется: MPI_Allreduce(local_index, global_index, MPI_MIN)
Таким образом определяется минимальный индекс различия среди всех процессов.

### Принятие решения

Если найден глобальный индекс различия, то выполняется сравнение символов в этой позиции. Иначе сравниваются длины строк.

Используемая топология: `MPI_COMM_WORLD` (плоская структура).

Коммуникации:

- 2 × MPI_Bcast (размеры)
- 2 × MPI_Bcast (данные)
- 1 × MPI_Allreduce

## 5. Implementation Details

### Структура проекта

```md
tasks/tsarkov_k_lexicographic_string_compare/
  common/include/common.hpp
  seq/include/ops_seq.hpp
  seq/src/ops_seq.cpp
  mpi/include/ops_mpi.hpp
  mpi/src/ops_mpi.cpp
  tests/
  report.md
```

### Классы

- `TsarkovKLexicographicStringCompareSEQ`
- `TsarkovKLexicographicStringCompareMPI`

### Особенности реализации

- Сравнение выполняется через `unsigned char`.
- В MPI используется тип `std::uint64_t` и `MPI_UINT64_T`.
- Обрабатываются крайние случаи:
  - пустые строки,
  - равные строки,
  - строки-префиксы.

Память:

- MPI-версия хранит копии строк на каждом процессе.
- В цикле сравнения отсутствуют дополнительные выделения памяти.

## 6. Experimental Setup

### Аппаратное обеспечение

- CPU: Intel Core i5-1135G7 (4 ядра / 8 потоков)
- RAM: 8 GB
- ОС: Windows 10

### Инструменты

- Компилятор: MSVC (Visual Studio 2022)
- MPI: MS-MPI
- Тип сборки: Release

### Параметры запуска

- 1 процесс (SEQ)
- 2 процесса (MPI)
- 4 процесса (MPI)

Тестирование выполнялось средствами фреймворка PPC.

## 7. Results and Discussion

### 7.1 Correctness

Корректность проверялась с помощью функциональных тестов:

- пустые строки,
- строки-префиксы,
- равные строки,
- строки с различием в середине.

Все тесты успешно пройдены:

- SEQ (1 процесс)
- MPI (2 процесса)
- MPI (4 процесса)

Результаты SEQ и MPI совпадают.

### 7.2 Performance

Измерения выполнены в режиме `pipeline`.

| Mode | Count | Time, s     | Speedup | Efficiency |
|------|-------|-------------|---------|------------|
| seq  | 1     | 0.00220434  | 1.00    | 1.00       |
| mpi  | 2     | 0.00160026  | 1.38    | 0.69       |
| mpi  | 4     | 0.00184250  | 1.20    | 0.30       |

#### Анализ

- При 2 процессах наблюдается ускорение.
- При 4 процессах эффективность снижается.
- Основные причины:
  - накладные расходы на передачу данных,
  - коллективная операция `MPI_Allreduce`,
  - малая вычислительная нагрузка задачи (O(n)).

Масштабируемость ограничена из-за низкой вычислительной интенсивности.

## 8. Conclusions

В работе реализован алгоритм проверки лексикографической упорядоченности строк в последовательной и MPI-версиях.
Параллельная версия обеспечивает ускорение при использовании двух процессов.
При дальнейшем увеличении числа процессов эффективность снижается из-за коммуникационных накладных расходов.
Корректность подтверждена тестами PPC.
Реализация полностью соответствует требованиям задания.

## 9. References

1. MPI Standard Documentation — <https://www.mpi-forum.org/docs/>
2. Документация Microsoft MPI — <https://learn.microsoft.com/>
3. Учебные материалы курса PPC (лекции и практики)

## Appendix (Optional)

```cpp
// Основной фрагмент сравнения (SEQ)
for (std::size_t index = 0; index < min_length; ++index) {
    if (first_str[index] != second_str[index]) {
        return (first_str[index] <= second_str[index]) ? 1 : 0;
    }
}
```
